.TH "EBUILD" "5" "October 24, 2002" "portage 2.0.42" "portage"
.SH "NAME"
ebuild \- the internal format, variables, and functions in an ebuild script
.SH "DESCRIPTION"
The
.BR ebuild (1)
program accepts a single ebuild script as an argument.  This script contains variables and commands that specify how to download, unpack, patch, compile, install and merge a particular software package from its original sources.  In addition to all of this, the ebuild script can also contain pre/post install/remove commands, as required.
.SH "EXAMPLES"
Here's a simple example ebuild:

.DS
# Copyright 1999\-2002 Gentoo Technologies, Inc.
.br 
# Distributed under the terms of the GNU General Public License v2
.br
#\ $Header$
.br 

S=${WORKDIR}/${P}
.br 
DESCRIPTION="Super\-useful stream editor"
.br 
SRC_URI="ftp://alpha.gnu.org/pub/gnu/sed/${P}.tar.gz"
.br 
HOMEPAGE="http://www.gnu.org/software/sed/sed.html"
.br 
KEYWORDS="x86 ppc sparc sparc64 alpha"
.br 
SLOT="0"
.br 
LICENSE="GPL\-2"
.br 
IUSE=""
.br 

DEPEND="virtual/glibc"
.br 
RDEPEND="virtual/glibc"
.br 

src_compile() {
.br
	econf
.br
	emake || die "emake failed"
.br 
}

src_install() {
.br
	into /usr
.br
	doinfo doc/sed.info
.br
	doman doc/sed.1
.br
	into /
.br
	dobin sed/sed
.br
	dodir /usr/bin
.br
	dosym /bin/sed /usr/bin/sed
.br
	dodoc COPYING NEWS README* THANKS TODO AUTHORS BUGS ANNOUNCE
.br 
}
.SH "VARIABLES"
.TP
\fBP\fR
This variable contains the package name without the ebuild revision. This variable should NEVER be modified.
.br
.BR 'xfree\-4.2.1\-r2.ebuild'\ $P=='xfree\-4.2.1'
.TP
\fBPN\fR
Contains the name of the script without the version number.
.br
.BR 'xfree\-4.2.1\-r2.ebuild'\ $PN=='xfree'
.TP
\fBPV\fR
Contains the version number without the revision.
.br
.BR 'xfree\-4.2.1\-r2.ebuild'\ $PV=='4.2.1'
.TP
\fBPR\fR
Contains the revision number or 'r0' if no revision number exists.
.br
.BR 'xfree\-4.2.1\-r2.ebuild'\ $PV=='r2'
.TP
\fBPF\fR
Contains the full package name \fI[PN]\-[PV]_r[PR]\fR
.br
.BR 'xfree\-4.2.1\-r2.ebuild'\ $P=='xfree\-4.2.1\-r2'
.TP
\fBA\fR
Contains all source files required for the package.  This variable must no
longer be defined because it gets autogenerated from the \fISRC_URI\fR
variables.
.TP
\fBWORKDIR\fR
Contains the path to the package build root
($PORTAGE_TMPDIR/portage/[category]/${PF}/work).
.TP
\fBS\fR
Contains the path to the temporary \fIbuild directory\fR. This variable is used by the functions \fIsrc_compile\fR and \fIsrc_install\fR. Both gets executed
with \fIS\fR as the current directory. This variable can be modified to match the extraction directory of a tarball for the package.
.TP
\fBD\fR
Contains the path to the temporary \fIinstall directory\fR
($PORTAGE_TMPDIR/portage/[category]/$PF/image).  ${D} should
prefix every write operation that does not involve the helper tools and functions.  Do not modify this variable.
.TP
\fBDESCRIPTION\fR
Should contain a short description of the package.
.TP
\fBSRC_URI\fR
Contains a list of URI's for the required source files.  It can contain
multiple URI's for a single source file.  The fastest location is chosen
if the file was not found at \fIGENTOO_MIRROR\fB\fR.
.TP
\fBHOMEPAGE\fR
Should contain a list of URL's for the sources main sites and other further
package dependend information.
.TP
\fBKEYWORDS\fR
Should contain appropriate list of arches that build is know to work/not work.  By default if you do not know if a
build runs under a particular arch simply omit that KEYWORD.  If the build will not work on that arch include it
as \-ppc for example.  If the ebuild is being submitted for inclusion, it must have ~arch set for architectures
where it has been PROVEN TO WORK.  (Packages KEYWORDed this way may be unmasked for testing by setting ACCEPT_KEYWORDS="~arch" on the command line, or in make.conf)
.TP
\fBSLOT\fR
This sets the SLOT for packages that may need to co\-exist.  By default
you should set SLOT="0" unless you know what you are doing and need to do otherwise.
.TP
\fBLICENSE\fR
This should be a space delimited list of licenses that the package falls
under.  This _must_ be set to a matching license in /usr/portage/licenses/.  
If the license does not exist in portage yet you must add it first.
.TP
\fBIUSE\fR
This should be a list of any and all USE flags that are leveraged within your 
build script.  The only USE flags that should not get listed here are arch 
related flags (currently x86 ppc sparc sparc64 alpha).
.TP
\fBDEPEND\fR
This should contain a list of all packages that are required for the
program to compile.
.TP
\fBRDEPEND\fR
This should contain a list of all packages that are required for this program to run (aka runtime depend).  If
this is not set, then it defaults to the value of DEPEND.
.SH "FUNCTIONS: EBUILD"
.TP
\fBpkg_setup\fR
This function can be used if the package needs specific setup actions or checks to be preformed before anything else.
.br
initial working directory of $PORTAGE_TMPDIR
.TP
\fBsrc_unpack\fR
This function is used to unpack all the sources in \fIA\fR to \fIWORKDIR\fR.  If not defined in the \fIebuild
script\fR it calls \fIunpack ${A}\fR.  Any patches and other pre configure/compile modifications should be done here.
.br
initial working directory of $WORKDIR
.TP
\fBsrc_compile\fR
All necessary steps for configuration and compilation should be done in here.
.br
initial working directory of $S
.TP
\fBsrc_install\fR
Should contain everything required to install the package in the temporary \fIinstall directory\fR.
.br
initial working directory of $S
.TP
\fBpkg_preinst pkg_postinst\fR
All modifications required on the live\-filesystem before and after the
package gets merged should be in here.  
Also commentary for the user should be listed here as it will be displayed last.
.br
initial working directory of $PWD
.TP
\fBpkg_prerm pkg_postrm\fR
Like the pkg_*inst functions but for unmerge.
.br
initial working directory of $PWD
.TP
\fBconfig\fR
This function should contain optional basic configuration steps.
.br
initial working directory of $PWD
.SH "HELPER UNPACK FUNCTIONS"
.TP
\fBunpack\fR \fI[list of sources] \fB
This function uncompresses and/or untars a list of sources into the current directory.
.SH "HELPER INSTALL FUNCTIONS"
.TP
\fBdodir\fR \fI[path]\fR
Creates a directory inside of ${D}.
.br
.BR 'dodir\ /usr/lib/apache'
creates ${D}/usr/lib/apache
.TP
\fBinto\fR \fI[path]\fR
Sets the root (\fIDESTTREE\fR) for other functions like dobin, dosbin, doman, doinfo, dolib.
.br
The default root is /usr.
.TP
\fBdobin\fR \fI[list of binaries]\fR
Installs a binary or a list of binaries into \fIDESTTREE\fR/bin.  Creates all necessary dirs.
.TP
\fBdosbin\fR \fI[list of binaries]\fR
Installs a binary or a list of binaries into \fIDESTTREE\fR/sbin.  Creates all necessary dirs.
.TP
\fBdolib dolib.a dolib.so\fR \fI[list of libraries]\fR
Installs a library or a list of libraries into \fIDESTTREE\fR/lib.
Creates all necessary dirs.
.TP
\fBdoman\fR \fI[list of man\-pages]\fR
Installs manual\-pages into \fIDESTDIR\fR/man/man[1\-8n] depending on the manual file ending.  
The files are gzipped if they are not already.  Creates all necessary dirs.  
.TP
\fBdohard dosym\fR \fI[filename] [linkname] \fR
Performs the ln command as either a hard link or symlink.
.TP
\fBdohtml\fR \fI [\-a filetypes] [\-r] [\-x list\-of\-dirs\-to\-ignore] [list\-of\-files\-and\-dirs]\fR
Installs the files in the list of files (space\-separated list) into /usr/share/doc/${PF}/html provided the file
ends in .html, .png, .js, .jpg or .css.  Setting \-a limits what types of files will be included, \-A appends to the default list, setting \-x sets which dirs to exclude (CVS excluded by default), \-r sets recursive.
.TP
\fBdoinfo\fR \fI[list of info\-files] \fR
Installs info\-pages into \fIDESTDIR\fR/info.  Files are automatically gzipped.  Creates all necessary dirs.
.TP
\fBdojar\fR \fl[list\-of\-files] \fR
Installs jar files into /usr/share/${PN}/lib and adds them to /usr/share/${PN}/classpath.env.
.TP
\fBdomo\fR \fI[list of locale\-files] \fR
Installs locale\-files into \fIDESTDIR\fR/usr/share/locale/[LANG] depending on local\-file's ending.  Creates all
necessary dirs.
.TP
\fBdopython\fR \fI[commands]\fR
Performs [commands] with python and returns the result.
.TP
\fBdosed\fR \fI "s:orig:change:g" [filename] \fR
Performs sed (including cp/mv filename) on [filename].
.TP
\fBfowners fperms\fR \fI[permissions] [files]\fR
Performs chown (fowners) or chmod (fperms), applying [permissions] to [files].
.TP
\fBinsinto\fR \fI[path]\fR
Sets the root (\fINSDESTTREE\fR) for the doins function.
.br
The default root is /.
.TP
\fBinsopts\fR \fI[options for install(1)]\fR
Can be used to define options for the install function used in doins.  The default is \fI\-m0644\fR.
.TP
\fBdoins\fR \fI[list of files]\fR
Installs files into \fIINSDESTTREE\fR.  This function uses install(1).
.TP
\fBexeinto\fR \fI[path}\fR
Sets the root (\fIEXEDESTTREE\fR) for the doexe function.
.br
The default root is /.
.TP
\fBexeopts\fR \fI[options for install(1)]\fR
Can be used to define options for the install function used in doexe. The
default is \fI\-m0755\fR.
.TP
\fBdoexe\fR \fI[list of executables]\fR
Installs a executable or a list of executable into \fIEXEDESTTREE\fR.
This function uses install(1).
.TP
\fBdocinto\fR \fI[path}\fR
Sets the relative subdir (\fIDOCDESTTREE\fR) used by dodoc.
.TP
\fBdodoc\fR \fI[list of document]\fR
Installs a document or a list of document into /usr/doc/${PV}/\fIDOCDESTTREE\fR.
Files are automatically gzipped.  Creates all necessary dirs.
.TP
\fBnewbin newsbin newlib newlib.so newlib.a newman newinfo newins newexe newdoc\fR \fI[file] [new filename]\fR
All these functions acct like the do* functions, but they only work with one
file and the file gets installed as \fI[new filename]\fR.
.TP
\fBemake\fR
This is used as a replacement for make.  Performs 'make ${MAKEOPTS}'
(as set in /etc/make.globals), default is \-j2.
.br
***warning***
.br
if you are going to use emake, make sure your build is happy with paralell makes
(make \-j2). It should be tested thoroughly as paralell makes are notorious
for failing _sometimes_ but not always.
.SH "SEE ALSO"
.BR ebuild (1),
.BR make.defaults (5),
.BR make.conf (5)
.TP
The \fI/usr/sbin/ebuild.sh\fR script.
.TP
The helper apps in \fI/usr/lib/portage/bin\fR.
.SH "FILES"
.TP
\fB/etc/make.conf\fR 
Contains variables for the build\-process and overrides those in make.defaults
.TP
\fB/etc/make.defaults\fR 
Contains the default variables for the build\-process, 
you should edit \fI/etc/make.conf\fR instead.
.SH "AUTHORS"
Achim Gottinger <achim@gentoo.org>
.br
Mark Guertin <gerk@gentoo.org>
.br 
Nicholas Jones <carpaski@gentoo.org>
.br
Mike Frysinger <vapier@gentoo.org>
