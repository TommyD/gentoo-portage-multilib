#!/bin/bash
# Copyright 1999-2005 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header$

if [ ${#} -lt 1 ] ; then
	echo "${0}: at least one argument needed" 1>&2
	exit 1
fi

# /usr/share/man
# /usr/X11R6/man
# /opt/gnome/man
# /opt/kde/man

BASE="/usr/share"
OLDBASE="$BASE"
i18n=""

for x in "$@" ; do
	[ "$x" == "--"     ] && BASE="/usr/share"
	[ "$x" == "-kde"   ] && BASE="/opt/kde"
	[ "$x" == "-gnome" ] && BASE="/opt/gnome"
	[ "$x" == "-x11"   ] && BASE="/usr/X11R6"
	if [ "${x:0:6}" == "-i18n=" ] ; then
		i18n="${x:6}/"
	fi
	if [ "${x:0:1}" == "-" ] ; then
		OLDBASE="$BASE"
		continue
	fi

	if [ "${x}" == ".keep" ] ; then
		continue
	fi

	BASE="$OLDBASE"
	suffix="${x##*.}"
		
	if [ "$suffix" == "gz" ] ; then
		compressed="gz"
		realname="${x%.*}"
		suffix="${realname##*.}"
	else
		realname="$x"
		compressed=""
	fi

	if [ "x" == "${suffix:1:1}" ] ; then
		OLDBASE="$BASE"
		BASE="/usr/X11R6"
	fi

	mandir=${i18n}man${suffix:0:1}

	if echo ${mandir} | egrep -q 'man[0-9n](|f|p|pm)$' -; then
		if [ -e "${x}" ] ; then
			if [ ! -d "${D}${BASE}/man/${mandir}" ] ; then
				install -d "${D}${BASE}/man/${mandir}"
			fi

			install -m0644 "${x}" "${D}${BASE}/man/${mandir}"

			if [ -z "${compressed}" ] ; then
				gzip -f -9 "${D}${BASE}/man/${mandir}/${x##*/}"
			fi
		else
			echo "doman: ${x} does not exist" 1>&2
		fi
	else
		echo -e "\adoman: '${x}' is probably not a man page; skipping" 1>&2
	fi
done
